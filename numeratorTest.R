setwd("~/Desktop/ds421_brainstorm/2016-02-27")
#http://wonder.cdc.gov/controller/datarequest/D124;jsessionid=63C3645FCEE7B4BFC833FA7052702E55
require(maps)
names(map("county"))

head(map("county")$x) # lon
head(map("county")$y) # lat

countyNames=map("county")$names
caCounty=countyNames[which(grepl("california", countyNames))]
length(caCounty)


## in alphabetical order, so it should be fine without string matching
map("county","ca",fill=T,col=c("red",rep("black",57))) ## check, this is in fact alameda county

deathRate=c()
for(i in 1:16){
  readIn <- read.delim(paste("~/Desktop/ds421_brainstorm/2016-02-27/Compressed Mortality, 1999-2014 (",i,").txt",sep=""))
  readIn=readIn[1:58,]
  readIn[,4]=ifelse(as.character(readIn[,4])=="Suppressed",NA,as.numeric(as.character(readIn[,4])))
  deathRate=cbind(deathRate, readIn[,4]/as.numeric(as.character(readIn[,5])))
}

dim(deathRate)

## mean across time, mean death rate at each location
## not exactly what they did in the paper, but they had finer temporal resolution

meanCounty=apply(deathRate,1,mean)
length(meanCounty)

test=lapply(1:58,function(x){meanCounty[x]/deathRate[x,]}) ##numerator 
numeratorMortality=do.call("rbind", test)

plot(density(numeratorMortality[1,])) ## within a county


