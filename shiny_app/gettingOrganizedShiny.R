combined<-read.csv("data/data_combined.csv")

require(maps)
data(county.fips)
county.fips

lookup<-read.csv("data/county_ID_lookup_table.csv",stringsAsFactors=T)

library(stringr)
#lookup$STATEFP10=str_pad(lookup[,1], 2, pad = "0")

combined$COUNTYFP10=str_pad(combined[,"COUNTYFP10"],3,pad="0")
combined$combinedFIPS=paste(combined$STATEFP10,combined$COUNTYFP10,sep="")
testMerge=merge(combined,county.fips,by.x="combinedFIPS",by.y="fips",all.x=T)
nrow(testMerge)
nrow(combined)
## missing 110, just carry on for now

names(testMerge)
forShiny<-testMerge[,c(4,29,19,7,13,14,15,16,25,26,27,28)]
names(forShiny)
head(forShiny)
names(forShiny)=c("year","county","state","mortalityOld",
                  "mortalityAll","drought3","drought5","drought1","unemployment","corn","soy","wheat")
forShiny$unemployment=as.numeric(as.character(forShiny$unemployment))
#ifelse(forShiny$unemployment=="",NA,forShiny$unemployment)
write.csv(forShiny,"shiny_app/newData/forShinyData.csv",row.names=F)


### cleaning up first stage betas for shiny

betas<-read.csv("code/analysis_stage2/combined_inputs/combined_betas.csv")
betas<-read.csv("code/analysis_stage2/combined_inputs/new/combined_betas.csv")

View(betas)


lookup$COUNTYFP10=str_pad(lookup[,"COUNTYFP10"],3,pad="0")
lookup$combinedFIPS=paste(lookup$STATEFP10,lookup$COUNTYFP10,sep="")

testMerge=merge(betas,lookup,by.x="countyID",by.y="GISJOIN",all.x=T)
names(testMerge)
testMerge2=merge(testMerge,county.fips,by.x="combinedFIPS",by.y="fips",all.x=T)
nrow(testMerge2)

names(testMerge2)

forShiny2=testMerge2[,c(27,24,4:21)]
forShiny2=testMerge2[,c(45,42,seq(4,38,2))]
names(forShiny2)[1:2]=c("county","state")
names(forShiny2)

write.csv(forShiny2,"shiny_app/forShinyData2.csv",row.names=F)
write.csv(forShiny2,"shiny_app/newData/forShinyData2.csv",row.names=F)
### stage 2

stage2<-read.csv("code/analysis_stage2/combined_inputs/combined_acs_epa_betas.csv")
stage2<-read.csv("code/analysis_stage2/combined_inputs/new/combined_acs_epa_betas.csv")

testMerge=merge(stage2,lookup,by.x="countyID",by.y="GISJOIN",all.x=T)
names(testMerge)

testMerge2=merge(testMerge,county.fips,by.x="combinedFIPS",by.y="fips",all.x=T)
names(testMerge2)

forShiny3=testMerge2[,c(47,44,22:41)]
forShiny3=testMerge2[,c(65,62,40:59)]

names(forShiny3)
names(forShiny3)[1:2]=c("county","state")

write.csv(forShiny3,"shiny_app/forShinyData3.csv",row.names=F)
write.csv(forShiny3,"shiny_app/newData/forShinyData3.csv",row.names=F)


#### for correlation plots

mergedBetas<-read.csv("code/analysis_stage2/combined_inputs/combined_acs_epa_betas.csv")
mergedBetas<-read.csv("code/analysis_stage2/combined_inputs/new/combined_acs_epa_betas.csv")

View(mergedBetas)
names(mergedBetas)
mergedBetas2=mergedBetas[,-seq(4,38,2)]
write.csv(mergedBetas,"shiny_app/forShinyData4.csv",row.names=F)
write.csv(mergedBetas2,"shiny_app/newData/forShinyData4.csv",row.names=F)

test<-read.csv("shiny_app/forShinyData4.csv")
View(test)

### for displaying second stage results

stage2m<-read.csv("results/stage2_results_means.csv")
stage2sd<-read.csv("results/stage2_results_sd.csv")
stage2m<-read.csv("results/new/stage2_results_means.csv")
stage2sd<-read.csv("results/new/stage2_results_sd.csv")
View(stage2m)
dim(stage2sd)
write.csv(stage2m[,c(2:6)],"shiny_app/forShinyData5a.csv",row.names=F)
write.csv(stage2sd[,c(2:6)],"shiny_app/forShinyData5b.csv",row.names=F)

write.csv(stage2m[,c(2:6)],"shiny_app/newData/forShinyData5a.csv",row.names=F)
write.csv(stage2sd[,c(2:6)],"shiny_app/newData/forShinyData5b.csv",row.names=F)


