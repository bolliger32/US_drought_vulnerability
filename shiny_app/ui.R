library(shiny)

shinyUI(fluidPage(
  
  # Application title
  titlePanel("US Drought Vulnerability"),
  h5("Dan Blaustein-Rejto (GSPP), Ian Bolliger (ERG), Hal Gordon (ARE), Andy Hultgren (ARE), Yang Ju (Landscape Arch. and Env. Planning), Kate Pennington (ARE), Sara Stoudt (Statistics)"),
  sidebarLayout(
    sidebarPanel(
      # conditionalPanel(
      #   condition="input.tb==0",
      #   selectInput("num", "Choose your Numerator:", choices = c('mortality'='1','income'='2')),
      #   selectInput("denom","Choose your Denominator:",choices=c('drought index'="1")),
      #   sliderInput("numD",
      #               "Lag:", 
      #               sep = "",
      #               value = 0,
      #               min = 0,
      #               step=1,
      #               max = 5),
      #   sliderInput("denomD",
      #               "Year:", 
      #               sep = "",
      #               value = 0,
      #               min = 0,
      #               step=1,
      #               max = 5)
      #   
      # ),
      # 
      conditionalPanel(
        condition = "input.tb==1 | input.tb==2" ,
        radioButtons("indic", "Indicator:",
                     c("Mortality Rate Adjusted >65" = "mortalityOld",#"mortalityOld"
                       #"Mortality Rate Adjusted <5"= "mortalityYoung",
                       "Mortality Rate Adjusted All"="mortalityAll",
                       "Unemployment Rate" = "unemployment",
                       "Drought 1 Year" = "drought1",
                       "Drought 3 Year"= "drought3",
                       "Drought 5 Year"="drought5",
                       "Corn Yield"="corn",
                       "Soy Bean Yield"="soy",
                       "Wheat Yield"="wheat")),
        h5("Drought Measure: weeks during the past 1/3/5 years each county gets impacted under drought severity levels D2, D3, and D4 (identified by drought monitor) weighted by the area of the impact."),
        h5("Purple: NA"),
        
        
        br(),
        
        sliderInput("y",
                    "Year:", 
                    sep = "",
                    value = 2004,
                    min = 2004,
                    step=1,
                    max = 2014,
                    animate=animationOptions(interval=1500, loop=TRUE))
      ),
      br(),
      conditionalPanel(
        condition = "input.tb == 2",
        textInput("state", label = "Choose a state to explore (continental US only, case matters) Click on a county of interest.", value = "California"),
        selectInput("quant","Color Quantiles:",choices=c("overall"="1",'by state'="2"))
        
      ),
      br(),
      conditionalPanel(
        condition = "input.tb == 2"
        #actionButton("go", "Go")
      ),
      
      
      conditionalPanel(
        condition = "input.tb == 5",
        selectInput("response","Response Variable:",choices=c("Mortality Rate >65 Adjusted"="6",
                                                              "Mortality Rate All Adjusted"= "12", "Unemployment Rate"="24",
                                                              "Corn Yield"="25",
                                                              "Soy Bean Yield"="26",
                                                              "Wheat Yield"="27")),
        selectInput("predictor","Predictor Variable:",choices=c("Drought 1 Year"="15",
                                                                "Drought 3 Year"="13",
                                                                "Drought 5 Year"="14")),
        h5("Purple: NA")
        #checkboxInput("checkbox", label = "Show Only Statistically Significant Under Permutation Tests", value = FALSE)
      ),
      conditionalPanel(
        condition = "input.tb == 6",
        selectInput("response2","Response Variable:",choices=c("Mortality Rate >65 Adjusted"="6",
                                                               "Mortality Rate All Adjusted"= "12", "Unemployment Rate"="24",
                                                               "Corn Yield"="25",
                                                               "Soy Bean Yield"="26",
                                                               "Wheat Yield"="27")),
        selectInput("predictor2","Predictor Variable:",choices=c("Drought 1 Year"="15",
                                                                 "Drought 3 Year"="13",
                                                                 "Drought 5 Year"="14")),
       # checkboxInput("checkbox", label = "Show Only Statistically Significant Under Permutation Tests", value = FALSE),
        
        textInput("state2", label = "Choose a state to explore (continental US only, case matters)", value = "California"),
        selectInput("quant2","Color Quantiles:",choices=c("overall"="1",'by state'="2"))
        
      ),
      
      conditionalPanel(
        condition = "input.tb == 7",
        selectInput("agg","Aggregation Method:",choices=c("mean over years"="1",
                                                          "standard deviation over years"= "2")),
        selectInput("secStageVar","Second Stage Predictor Variable:",
                    choices=c(#"Weighted population"="1",
                              "Proportion of Age<5"="1",
                              "Proportion of Age>65"="2",
                              "Proportion Hispanic"="3",
                              "Proportion White"="4",
                              #"Proportion Black"="6",
                              "Proportion Male"="5",
                              "Proportion Who Work in Farming or Ranching"="6",
                              #"Population in the Workforce"="9",
                              #"Weighted Number of Households"="10",
                              "Average Household Water Bill (conditional on paying a water bill)"="7",
                              #"Weighted Number of Houses Who Pay a Water Bill"="12",
                              "Mean Household Income"="8",
                              #"Weighted Number of Households Who Reported Income"="14",
                              "Proportion of Households Who Own Their Own Home"="9"))#,
                              #"Weighted Households Who Reported Homewownership Status"="16"))
        
        #checkboxInput("checkbox", label = "Show Only Statistically Significant Under Permutation Tests", value = FALSE),
        
        #textInput("state2", label = "Choose a state to explore (continental US only, case matters)", value = "California"),
        #selectInput("quant2","Color Quantiles:",choices=c("overall"="1",'by state'="2"))
        
      ),
      
      conditionalPanel(
        condition = "input.tb == 8",
        selectInput("agg2","Aggregation Method:",choices=c("mean over years"="1",
                                                           "standard deviation over years"= "2")),
        selectInput("secStageVar2","Second Stage Predictor Variable:",
                    choices=c(#"Weighted population"="1",
                      "Proportion of Age<5"="1",
                      "Proportion of Age>65"="2",
                      "Proportion Hispanic"="3",
                      "Proportion White"="4",
                      #"Proportion Black"="6",
                      "Proportion Male"="5",
                      "Proportion Who Work in Farming or Ranching"="6",
                      #"Population in the Workforce"="9",
                      #"Weighted Number of Households"="10",
                      "Average Household Water Bill (conditional on paying a water bill)"="7",
                      #"Weighted Number of Houses Who Pay a Water Bill"="12",
                      "Mean Household Income"="8",
                      #"Weighted Number of Households Who Reported Income"="14",
                      "Proportion of Households Who Own Their Own Home"="9")),
        
        #checkboxInput("checkbox", label = "Show Only Statistically Significant Under Permutation Tests", value = FALSE),
        
        textInput("state3", label = "Choose a state to explore (continental US only, case matters)", value = "California"),
        selectInput("quant3","Color Quantiles:",choices=c("overall"="1",'by state'="2"))
        
      ),
      conditionalPanel(
        condition = "input.tb == 10",
        selectInput("response4","Response Variable:",choices=c("Mortality Rate >65 Adjusted"="6",
                                                               "Mortality Rate All Adjusted"= "12", "Unemployment Rate"="24",
                                                               "Corn Yield"="25",
                                                               "Soy Bean Yield"="26",
                                                               "Wheat Yield"="27")),
        selectInput("predictor4","Predictor Variable:",choices=c("Drought 1 Year"="15",
                                                                 "Drought 3 Year"="13",
                                                                 "Drought 5 Year"="14")),
        selectInput("agg3","Aggregation Method:",choices=c("mean over years"="1",
                                                           "standard deviation over years"= "2")),
        selectInput("secStageVar3","Second Stage Predictor Variable:",
                    choices=c(#"Weighted population"="1",
                      "Proportion of Age<5"="1",
                      "Proportion of Age>65"="2",
                      "Proportion Hispanic"="3",
                      "Proportion White"="4",
                      #"Proportion Black"="6",
                      "Proportion Male"="5",
                      "Proportion Who Work in Farming or Ranching"="6",
                      #"Population in the Workforce"="9",
                      #"Weighted Number of Households"="10",
                      "Average Household Water Bill (conditional on paying a water bill)"="7",
                      #"Weighted Number of Houses Who Pay a Water Bill"="12",
                      "Mean Household Income"="8",
                      #"Weighted Number of Households Who Reported Income"="14",
                      "Proportion of Households Who Own Their Own Home"="9"))#,
        #,
        #checkboxInput("checkbox", label = "Show Only Statistically Significant Under Permutation Tests", value = FALSE),
        
        #textInput("state2", label = "Choose a state to explore (continental US only, case matters)", value = "California"),
        #selectInput("quant2","Color Quantiles:",choices=c("overall"="1",'by state'="2"))
        
      ),
      
      conditionalPanel(
        condition = "input.tb == 9",
        selectInput("response3","Response Variable:",choices=c(#"Mortality Rate >65 Adjusted"="6",
                                                               "Mortality Rate All Adjusted"= "12", "Unemployment Rate"="24",
                                                               "Corn Yield"="25",
                                                               "Soy Bean Yield"="26",
                                                               "Wheat Yield"="27")),
        selectInput("predictor3","Predictor Variable:",choices=c(#"Drought 1 Year"="15",
                                                                 "Drought 3 Year"="13")),
                                                                 #"Drought 5 Year"="14")),
        selectInput("msd","Form of Input Variables in Stage Two:",choices=c("means"="1",'standard deviations'="2")),
        h5("Note: all input variables in second stage included initially, 
           removed those with high variance inflation factors due to multicollinearity issues "),
        h5("Note: Standard Errors are currently 'out of the box'. "),
        h5("Weighted Regression: First Stage (clustered) Standard Errors")
        
        #,
        #checkboxInput("checkbox", label = "Show Only Statistically Significant Under Permutation Tests", value = FALSE),
        
        #textInput("state2", label = "Choose a state to explore (continental US only, case matters)", value = "California"),
        #selectInput("quant2","Color Quantiles:",choices=c("overall"="1",'by state'="2"))
        
      )
      
      
      
    ),
    #   br(),
    #   conditionalPanel(
    #     condition = "input.tb==5" ,
    #     radioButtons("indic2", "Indicator:",
    #                  c("Mortality Rate Adjusted >65" = "mortalityOld",#"mortalityOld"
    #                    #"Mortality Rate Adjusted <5"= "mortalityYoung",
    #                    "Mortality Rate Adjusted All"="mortalityAll",
    #                    "Unemployment Rate" = "unemployment",
    #                    "Drought 1 Year" = "drought1",
    #                    "Drought 3 Year"= "drought3",
    #                    "Drought 5 Year"="drought5"))
    #  
    # ),
    
    
    
    mainPanel(
      tabsetPanel(id="tb",type = "tabs", 
                  
                  tabPanel("First Stage Variables", plotOutput("fullMap"),plotOutput("hist2"),value=1), 
                 # tabPanel("First Stage Variables- By State", plotOutput("byState",click = "plot_click"),plotOutput("click_info"),plotOutput("hist4"),value=2), 
                  tabPanel("Coefficients from First Stage", plotOutput("fullMap2"),plotOutput("hist"),value=5), 
                  #tabPanel("Coefficients from First Stage- By State",plotOutput("byState2"),plotOutput("hist5") ,value=6), #plotOutput("coeff1_state",click = "plot_click"),plotOutput("click_info")
                  tabPanel("Second Stage Variables", plotOutput("fullMap3"),plotOutput("hist3"),value=7),
                  #tabPanel("Second Stage Variables- By State",plotOutput("byState3"),plotOutput("hist6"),value=8),
                  tabPanel("Second Stage Correlations",plotOutput("corr"),value=10),
                  tabPanel("Second Stage Results", tableOutput("table"),value=9)
                  
                  
      )
      
      
    )
  )
))