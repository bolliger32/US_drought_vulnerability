# Analysis Stage 2 Readme

## Description

This readme describes the contents of code/analysis_stage2. 

## Files
- merge_betas_predictors.R	
- merge_stage1_betas.R
- clean_combined_inputs_outputs.R

These R scripts merge together data from the data folder into 2 tidy tables: one with all the summarized beta values from stage 1 and county-level explanatory variables, and one with all of these values except outlier stage 1 beta values. These tables are analyzed in the regression scripts.

- regressions.R
- filtered_regressions.R
- weighted_regression.R


These R scripts run several linear model regressions, described below.


- create_figures.R
This R script exports the regression results into tidy, labeled tables in the paper folder.


## Folders
- combined_inputs			


This folder contains the output from the merge files, which are used as input in the regressions code. 

Columns represent interaction coefficients for OLS regressions of a predcitor on a response variable. The predictor variables are coded as pxx and the responses are coded as rxx where the number xx refers to column xx in data/combined_data.csv. 

For example, r11p14 refers to the coefficient of a regression of column 14 on column 11.

##Outputs
CSV files in results: 

- stage2_results_3yr_means is the results from the basic linear model using first stage beta values from the 3yr drought measure as the response variable and means of each county's characteristics over time as the predictor (also referred to as explanatory) variables.

- stage2_results_3yr_sd is the same as above except that the standard deviations of each county's characteristics over time are used as the explanatory variables.

- filtered_stage2_results indicate models identical to those described above, but with the input data first processed to remove outlying first stage beta values

- weighted_stage2_results indicate results from a linear model using first stage beta values (with 1, 3 and 5 yr denoting the drought measure used) as the response variable and the means or standard deviations (indicated with the file name) of the county characteristics over time as the predictor variables. The values of the response and predictor variables for each county are weighted by the inverse of the variance of the beta value for that county over time (calculated in the stage 1 analysis). E.x.: county i with stage 1 beta value b, variance of the beta value v and response variable r will be included in the regression as b/v ~ r/v.


##Model

Regression coefficient from a regression of each Analysis Stage 1 beta value (the coefficients from regression outcomes such as unemployment or mortality on drought indicators) on the county-level characteristics. 

Equation: stage_1_county ~ county_characteristics

County characteristics are described in data/acs data/epa and data/rural and include:

- proportion of population under 5
- proportion of population over 65
- proportion hispanic
- proportion white
- proportion male
- proportion who workin farming or ranching
- average household water bill (conditional on paying water bill)
- mean household include
- proportion of households who own their own home
- whether the county is rural 
- number of water intensive sites in county observed by EPA

This model is run with each county characteristic with raw data in panel/time-series format summarized by its mean and by its standard deviation.

For both the means and standard deviations, this model is run:

- with a simple linear model, 
- with a simple linear model using data that has had the counties with beta values > 95th and < 5th percentile omitted, and 
- with a weighted linear model with the weight set to  the inverse of the variance of the beta measure for that county over time (calculated in the stage 1 analysis).

With each of these models, and with each set of transformed explanatory data (mean and standard deviation) the model is run with the 1st stage beta values using the 1 year, 3 year and 5 year drought measures.


