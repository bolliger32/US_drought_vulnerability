#description: Merge Analysis Stage 1 Coefficients into 1 Data Frame
#inputs: beta csv files from code/analysis_stage1/coefficients
#outputs: csv of betas from stage 1 matched to county ID 
#authors: Dan Blaustein Rejto
#start date: 4/18/2016

#get file names
file_list = list.files("code/analysis_stage1/coefficients", full.names=T, pattern="*.csv")

#import csvs as list of dataframes
import.list <- lapply(file_list, read.csv, header = TRUE) 
my.df <- Reduce(function(x, y) merge(x, y, all=FALSE,by=c("countyID"),
                                     all.x=TRUE, all.y=TRUE),import.list,accumulate=F)

#drop extraneous columns
clean_dat = my.df[ , !names(my.df) %in% c("coeff","coeff.x","coeff.y")]

#rename column headers with identifying codes from file names (key in readme)
#for (i in 1:length(file_list)) {
#  names(my.df)[i+1] <- substr(toString(file_list[i]),45,50)
#}

#save
if (dir.exists(paths = "code/analysis_stage2/combined_inputs")==F){
  dir.create("code/analysis_stage2/combined_inputs")
}
  
write.csv(clean_dat,file="code/analysis_stage2/combined_inputs/combined_betas.csv")