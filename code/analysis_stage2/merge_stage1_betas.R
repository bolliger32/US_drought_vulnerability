#description: Merge Analysis Stage 1 Coefficients into 1 Data Frame
#inputs: beta csv files from code/analysis_stage1/coefficients2
#outputs: csv of betas from stage 1 matched to county ID 
#authors: Dan Blaustein Rejto
#start date: 4/18/2016

#clean environment
rm(list=ls())

#get file names
file_list = list.files("../results/coefficients_stage1/", full.names=T, pattern="*.csv")

#import csvs as list of dataframes
import_list <- lapply(file_list, read.csv, header = TRUE) 

#merge
my.df <- Reduce(function(x, y) merge(x, y, all=FALSE,by=c("countyID"),all.x=TRUE, all.y=TRUE),import_list,accumulate=F)

#reformat with coefficient columns and stand error columns grouped
coeffs = my.df[,c(1,seq(2,37,2))]
sds = my.df[,c(1,seq(3,37,2))]
my.df = merge(coeffs, sds,all=TRUE,by="countyID")

#save
if (dir.exists(paths = "analysis_stage2/combined_inputs")==F){
  dir.create("analysis_stage2/combined_inputs")
}
write.csv(my.df,file="analysis_stage2/combined_inputs/combined_betas.csv")