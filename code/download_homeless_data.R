## homelessness data download
## DBR
## 2016-03-15

wd="~/Desktop/drought_project/data/homeless" ## replace with your own path name
setwd(wd)

require(xlsx)
require(maptools)
require(downloader)

##download csv of state abbreviations 
if (file.exists("state_lookup_table.csv")==F){ 
  download("http://www.fonz.net/blog/wp-content/uploads/2008/04/states.csv","state_lookup_table.csv", mode="wb")
}

state = read.csv("state_lookup_table.csv",1,stringsAsFactors=FALSE) 
  
#if CoC shapefiles haven't been downloaded yet, download it
if (dir.exists("raw")==F){   
  #create folder for raw data working directory
  dir.create("raw")
  cocs_dir = "~/desktop/drought_project/data/homeless/raw" #replace with your own path name 
  setwd(cocs_dir)
  
  
  ##download, extract and read 2014 CoC shape file  zip files 
  ## All raw data and metadata available here https://www.hudexchange.info/coc/gis-tools/
  
  #ST = state acronym
  
  for (row in 1:length(state$Abbreviation)) {
    ST = paste(state$Abbreviation[row],'_2014','.zip',sep="")
    url = paste("https://www.hudexchange.info/resource/reportmanagement/published/CoC_GIS_State_Shapefile_",ST,sep="") 
    download(url,ST, mode="wb")
    #unzip (ST, exdir = state$Abbreviation[row])  #used in current version
    unzip (ST, exdir = "./")  #more efficient to be used in revisions
  } 

  #clean: delete original zip files
    unlink("*.zip")
}

##Download Point in Time Homeless County Data for each CoC 2007-2015
setwd('..') # move to parent directory, base homeless data folder
if (file.exists("PIT_Counts.xlsx")==F){
  download("https://www.hudexchange.info/resources/documents/2007-2015-PIT-Counts-by-CoC.xlsx",
         "PIT_Counts.xlsx",mode="wb")
}
