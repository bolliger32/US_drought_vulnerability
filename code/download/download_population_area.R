# --------------------------------
# Download US County rural/non-rural 
# status for 2013.
# For DS421 SP2016 group project.
#
# Designations described here:
# http://www.ers.usda.gov/topics/rural-economy-population/rural-classifications.aspx
#
# .xls file downloaded from here:
# http://www.ers.usda.gov/data-products/rural-urban-continuum-codes/.aspx
#
# 4/23/16
# Andy Hultgren
# hultgren@berkeley.edu
# --------------------------------

# Comment this out for upload to git
#setwd("C:/Users/Andy/Documents/ARE/Classes/z - DS421 - Stats 261/gitrepo/US_drought_vulnerability")

library(xlsx)
library(dplyr)

# Download the data from USDA
URL      <- "http://www.ers.usda.gov/datafiles/RuralUrban_Continuum_Codes/ruralurbancodes2013.xls"
destfile <- "../../data/rural/rural_raw/ruralurbancodes2013.xls"
download.file(URL, destfile, mode="wb")

# Define rural/non-rural dummy
rural.df <- read.xlsx(destfile, sheetName = "Rural-urban Continuum Code 2013")
rural.df <- mutate(rural.df, rural=0)
filter <- rural.df$RUCC_2013 > 3 # 3 is the cutoff for 'urban'
rural.df$rural[filter] <- 1

# Save the data as a .csv
final.df <- subset(rural.df, select = -c(Population_2010,RUCC_2013, Description) )
write.csv(final.df, file = "../../data/rural/rural.csv")



# -------------------
# OLD CODE
# OLD DATA SOURCE. I FOUND A BETTER ONE, BUT
# KEEP THIS JUST IN CASE IT'S USEFUL.
# -------------------
'''
# Download the data from Census.gov
URL      <- "http://www2.census.gov/geo/docs/maps-data/data/gazetteer/Gaz_counties_national.zip"
destfile <- "data/population_area/population_area_raw/Gaz_counties_national.zip"
download.file(URL, destfile)

# Unzip the data to the raw data folder
unzip (destfile, exdir = "data/population_area/population_area_raw")

# Read in the unzipped data into a Data Frame. 
# The unzipped data comes as a tab separated text file.
pop_area_data.df <- read.delim(
  "data/population_area/population_area_raw/Gaz_counties_national.txt",
  sep="\t", header=TRUE)

# Calculate the population density for 2010
pop_area_data.df$popDensity10 <- pop_area_data.df$POP10 / pop_area_data.df$ALAND_SQMI

rural <- (pop_area_data.df$popDensity10 < 100)
hist(pop_area_data.df$popDensity10)

'''

