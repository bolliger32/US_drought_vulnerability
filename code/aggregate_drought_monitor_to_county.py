__author__ = 'Yang'
# require arcpy in python 2 to process to run the script
# the input and output datasets are ignored in github,and stored locally
import arcpy
from arcpy import env
import os
import sys

# Open a file folder
path = r"..\data\drought_monitor\original_drought_monitor_data"
dirs = os.listdir(path)
county = r"..\data\drought_monitor\original_drought_monitor_data\nhgis0041_shape\nhgis0041_shape\US_county_2010.shp"
env.workspace = path
env.overwriteOutput = True
for file in dirs[:50]:
    if file.endswith('.shp'):
        drought = file
        inFeatures = [county,drought]
        outFeatures = r"..\data\drought_monitor\processed_drought_monitor_data\temp.shp"
        results = r"..\data\drought_monitor\processed_drought_monitor_data\csv\csv"+ file[:-4]+".xls"
        # Process: Add Field
        arcpy.AddField_management(drought, "DM_mod", "LONG", "", "", "", "", "NULLABLE", "NON_REQUIRED", "")
        # Process: Calculate Field, add 1 to each drought moinitor class to differentiate
        # drought area with the rest (DM_mod = DM+1)
        arcpy.CalculateField_management(drought, "DM_mod", "!DM! +1", "PYTHON", "")
        # Process: Union the data
        arcpy.Union_analysis(inFeatures, outFeatures, "ALL", "", "GAPS")
        # Process: Add Geometry Attributes, calculate the area (squre mile) of each drought monitor class in each county in field "POLY_AREA"
        arcpy.AddGeometryAttributes_management(outFeatures, "AREA", "", "SQUARE_MILES_US", "PROJCS['USA_Contiguous_Albers_Equal_Area_Conic',GEOGCS['GCS_North_American_1983',DATUM['D_North_American_1983',SPHEROID['GRS_1980',6378137.0,298.257222101]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]],PROJECTION['Albers'],PARAMETER['False_Easting',0.0],PARAMETER['False_Northing',0.0],PARAMETER['Central_Meridian',-96.0],PARAMETER['Standard_Parallel_1',29.5],PARAMETER['Standard_Parallel_2',45.5],PARAMETER['Latitude_Of_Origin',37.5],UNIT['Meter',1.0]]")
        # Process: Table To Excel
        arcpy.TableToExcel_conversion(outFeatures, results, "ALIAS", "CODE")
        print file




