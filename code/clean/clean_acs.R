#description: Summarize ACS Data by County
#inputs: -acs data from data/acs/acs.csv 
#outputs: -csv of means and sd of all acs variables by county
#authors: Dan Blaustein Rejto
#start date: 4/20/2016

#packages
require(dplyr)

#inputs
acs = read.csv("../data/acs/acs.csv",header=T,stringsAsFactors=F)

#reformat acs column ids from county=1 to fixed length of 5 with leading 0s and 1 trailing 0
old_county = acs[,2]
new_county = sprintf("%04d0", old_county) #creates list of col values coerced to 5 digit strings

#reformat acs column ids from state = 1 to fixed length of 2 with leading 0s
old_state = acs[,3]
new_state = sprintf("%02d", old_state) #creates list of col values coerced to 2 digit strings

#create combined new column to match GISJOIN format of G0100010
new_col = paste0("G",new_state,new_county)

#add new column to acs dataframe
acs["GISJOIN"] = new_col

#transform WATP_WGTP (number of households paying water bill) to % of households paying
acs[,16] = (acs[,16]/acs[,14])

#remove weighting variables that are inappropriate for analysis 
acs = subset(acs, select=-c(work_PWGTP,HINCP_WGTP,tenure_WGTP))

#remove extraneous identifying columns
acs = subset(acs, select=-c(X,COUNTYFP10,STATEFP10,cntyname))

#summarize means and sd's of variables for each county
grouped <- acs %>% group_by(GISJOIN)

summarized_acs = summarize_each(grouped,funs(mean,sd))

#save
write.csv(summarized_acs,file="../data/acs/summarized_acs.csv")
