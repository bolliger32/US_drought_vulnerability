## clean_unemployment.R
## Cleaning Raw Unemployment Data
## Inputs: raw unemployment data (one csv per year)
## Ouptus: unemploymentClean.csv
## Author: Sara Stoudt
## Date: 3/30/16


files=list.files("../data/unemployment/raw/")

unemployment=vector("list",length(files))
i=1
for(file in files){
  unemployment[[i]]=readLines(paste("../data/unemployment/raw/",file))
  ##unlink(file) ## if you want to delete the raw file
  i=i+1
}

data=c()
for(i in 1:length(unemployment)){
  removeHeader=unemployment[[i]][7:length(unemployment[[i]])]
  removeTail=removeHeader[1:(length(removeHeader)-3)]
  
  splitOnWhiteSpace=lapply(removeTail,strsplit,'\\s\\s+')
  
  ## this is gross and slower than it needs to be, but for now it works
  ## make that REALLY SLOW
  for(j in 1:length(splitOnWhiteSpace)){
    data=rbind(data,splitOnWhiteSpace[[j]][[1]])
  }
  print(i)
  
}
dim(data)
data=as.data.frame(data)
names(data)=c("LAUS_CODE","state_FIPS","county_FIPS","countyState","year",
              "laborForce","employed","unemployed","unemploymentRate")

write.csv(data,"../data/unemployment/unemploymentClean.csv",row.names=F)
## can now join on FIPS code

